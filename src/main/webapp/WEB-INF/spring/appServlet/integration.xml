<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:context="http://www.springframework.org/schema/context" xmlns:si="http://www.springframework.org/schema/integration"
	xmlns:si-ftp="http://www.springframework.org/schema/integration/ftp"
	xmlns:amqp="http://www.springframework.org/schema/integration/amqp"
	xmlns:jms="http://www.springframework.org/schema/integration/jms"
	xmlns:stream="http://www.springframework.org/schema/integration/stream"
	xmlns:rabbit="http://www.springframework.org/schema/rabbit"
	xsi:schemaLocation="http://www.springframework.org/schema/integration/ftp http://www.springframework.org/schema/integration/ftp/spring-integration-ftp-2.0.xsd
		http://www.springframework.org/schema/integration/amqp http://www.springframework.org/schema/integration/amqp/spring-integration-amqp-2.0.xsd
		http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms-3.0.xsd
		http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-2.0.xsd
		http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
		http://www.springframework.org/schema/integration/jms http://www.springframework.org/schema/integration/jms/spring-integration-jms-2.0.xsd
		http://www.springframework.org/schema/integration/stream http://www.springframework.org/schema/integration/stream/spring-integration-stream-2.0.xsd
		http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">

	<!-- Allow property place holders -->
	<bean
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer" />

	<!-- General SI things. -->
	<si:annotation-config />

	<!-- FTP - pick up the zoneinfo files -->
	<bean id="zoneinfoFtpClientFactory"
		class="org.springframework.integration.ftp.session.DefaultFtpSessionFactory">
		<property name="host" value="elsie.nci.nih.gov" />
		<property name="port" value="22" />
		<property name="username" value="anonymous" />
		<property name="password" value="anonymous" />
		<property name="clientMode" value="0" />
		<property name="bufferSize" value="100000" />
	</bean>

	<si-ftp:inbound-channel-adapter id="zoneInfoFtpInbound"
		channel="zoneinfoChannel" session-factory="zoneinfoFtpClientFactory"
		charset="UTF-8" auto-create-local-directory="true"
		delete-remote-files="false" filename-pattern="tzdata*.tar.gz"
		remote-directory="pub" local-directory="${java.io.tmpdir}${file.separator}tzdata">
		<si:poller cron="0 * * * * *" max-messages-per-poll="-1" />
	</si-ftp:inbound-channel-adapter>

	<si:channel id="zoneinfoChannel" datatype="java.io.File" />

	<si:service-activator input-channel="zoneinfoChannel"
		ref="timeZoneService" method="refreshTimeZones" />

</beans>
